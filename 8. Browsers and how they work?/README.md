# Браузер и как он работает?

Браузер - неотъемлемая часть нашей повседневной интернет жизни. Однако, как именно он работает, остается для многих загадкой. В этой статье мы проведем глубокий анализ работы браузера, начиная с основных компонентов и заканчивая тем, как он отображает веб-страницы на наших экранах.

## Высокоуровневая архитектура Браузера: Разбор основных компонентов

Высокоуровневая архитектура браузера представляет собой сложную систему, объединяющую различные компоненты для обеспечения удобства пользователя и эффективной работы веб-приложений. Давайте рассмотрим основные элементы высокоуровневой архитектуры браузера.

![Компоненты браузера](https://web.dev/static/articles/howbrowserswork/image/browser-components-9cd8ff834cc9c_856.png)

### 1. Браузерный движок (Browser Engine)

Браузерный движок - это ключевый компонент, отвечающий за взаимодействие с отображаемым контентом. Он включает два основных модуля:
- **Рендеринговый движок (Rendering Engine):** Отвечает за разбор HTML и CSS, создание Document Object Model(DOM), и отрисовку контента на экране. Популярные рендеринговые движки включают Blink (используется в Google Chrome) и Gecko (используется в Mozilla Firefox).
- **Движок макета (Layout Engine):** Занимается распределением и размещением элементов на странице, учитывая стили и размеры. Он определяет, как страница будет выглядеть после применения CSS.

### 2. Исполнитель JavaScript (JavaScript Engine)

JavaScript Engine отвечает за выполнение JavaScript-кода, который может взаимодействовать с DOM и вносить изменения на веб-странице. Наиболее известные JavaScript-движки включают V8 (используется в Google Chrome) и SpiderMonkey (используется в Mozilla Firefox).

### 3. Отображение (Rendering)

Отображение включает в себя несколько этапов:
- **Отображение документа (Document Rendering):** Рендеринговый движок создает DOM, а затем Layout Engine определяет, как элементы отображаться на странице.
- **Графическое отображение (Graphics Rendering):** Этап, на котором происходит отрисовка изображений, текста и других графических элементов.
- **Композитинг (Compositing):** Объединение отрисованных элементов в один слой для эффективного отображения на экране.

### 4. Сетевые операции

Браузер также включает компонент, отвечающий за сетевый операции:
- **Модуль сетевых запросов (Network Requests):** Отправляет HTTP-запросы к серверам, получает ответы и передает их рендеринговому движку для обработки.

### 5. Хранилища данных

Браузерные хранилища предоставляют средства для хранения данных:
- **Кэш-память (Cache):** Хранит копии ранее загруженных ресурсов, чтобы ускорить загрузку страниц при повторных запросах.
- **Cookies и Local Storage:** Используется для хранения данных на стороне клиента, таких как сессионная информация или пользовательские предпочтения.

### 6. Пользовательский интерфейс (User Interface)

Пользовательский интерфейс браузера включает элементы управления, такие как адресная строка, закладки и кнопки навигации.

### 7. Менеджер сессий и безопасности

Этот компонент отвечает за управление сессиями пользователя и обеспечивает безопасность взаимодействия с веб-ресурсами. Включает в себя обработку HTTPS, управление cookies и другие меры безопасности.

## Архитектура браузера

### Процесс браузера

Браузер обычно состоит из нескольких процессов, каждый из которых выполняет свою уникальную функцию. Основные процессы включают:
- **Процесс отображения (Rendering Engine):** Этот процесс отвечает за интерпретацию HTML и CSS, а также за отображение контента на экране.
- **Процесс браузерного движка (Browser Engine):** Этот процесс управляет взаимодействием между пользователем и отображаемым контентом. Он обрабатывает пользовательский ввод и управляет событиями, такими как клики и навигация.
- **Процесс расширений (Extension Process):** Если у вас установлены расширения, каждое из них может работать в отдельном процессе для изоляции и обеспечения стабильности браузера.

### Жизненный цикл запроса страницы

1. **Ввод адреса:** Пользователь вводит URL в адресную строку браузера.
2. **DNS-запрос:** Браузер отправляет запрос на сервер DNS для получения IP-адреса сайта.
3. **Установление соединения:** Браузер устанавливает TCP-соединение с сервером, используя полученный IP-адрес и порт 80 (для HTTP) или 443 (для HTTPS).
4. **HTTP-запрос:** Браузер отправляет HTTP-запрос на сервер, запрашивая страницу.
5. **Серверная обработка:** Сервер обрабатывает запрос, выполняет необходимые действия и отправляет обратно HTTP-ответ с требуемым контентом.
6. **Отрисовка страницы:** Браузер получает ответ и начинает процесс отрисовки страницы.

## Механизм рендеринга страницы

Как только пользователь запрашивает определенный документ, механизм рендеринга начинает получать содержимое запрошенного документа. Это делается через сетевой уровень. Механизм рендеринга начинает получать содержимое этого конкретного документа частями по 8 КБ с сетевого уровня. После этого начинается основной поток движка рендеринга.

![Процесс рендеринга страницы](https://browserstack.wpenginepowered.com/wp-content/uploads/2019/11/Screenshot-2019-11-12-at-3.26.19-PM.png)

Четыре основных шага включают в себя:
1. Запрошенная HTML-страница анализируется механизмом рендеринга по частям, включая внешние файлы CSS и элементы стиля. Затем элементы HTML преобразуются в узлы DOM, чтобы сформировать DOM.
2. Одновременно браузер также создает дерево рендеринга. Это дерево включает в себя как информацию о стиле, так и визуальные инструкции, определяющие порядок отображения элементов. Дерево рендеринга гарантирует, что контент отображается в желаемом порядке.
3. Далее дерево рендеринга проходит процесс компоновки. При создании рендеринга значения положения или размера не назначаются. Весь процесс расчета значений для оценки желаемой позиции называется процессом компоновки. В этом процессе каждому узлу присваиваются точные координаты. Это гарантирует, что каждый узел появится в точном положении на экране.
4. Последним шагом является рисование экрана, при этом просматривается дерево рендеринга и вызывается метод средства рендеринга Paint(), который рисует каждый узел на экране с использованием внутреннего уровня пользовательского интерфейса.

Однако, каждый браузер имеет свой собственный уникальный механизм рендеринга. Естественно, каждый браузер по-своему интерпретирует веб-страницы на экране пользователя. Вот тут-то перед веб-разработчиками и возникает проблема, связанная с кроссбраузерной совместимостью их веб-сайта.

[Кроссбраузерное тестирование](https://www.browserstack.com/live) - это метод обеспечения качества, используемый для проверки согласованности веб-приложений с точки зрения функциональности и дизайна в нескольких браузерах. Эти тесты позволяют группам контроля качества исследовать любые проблемы путем проведения [адаптивного теста](https://www.browserstack.com/responsive), который может возникнуть при доступе к их веб-сайту через разные браузеры или версси браузера.

## JavaScript и асинхронность

JavaScript выполняется в основном потоке браузера. Асинхронные операции, такие как запросы к серверу или обработка событий, выполняются в отдельных потоках для предотвращения блокировки основного потока.

Event Loop (цикл событий) - это ключевой механизм в асинхронной модели выполнения JavaScript, который позволяет браузеру или среде выполнения NodeJS эффективно обрабатывать асинхронные операции. Этот механизм позволяет JavaScript выполнять задачи асинхронно, не блокируя основной поток выполнения.

## Отображение изображений и медиа

Браузер загружает изображения и другие медиа-ресурсы параллельно с выполнением остальных операций. Он оптимизирует отображение изображений, например, используя lazy loading для улучшения производительности.

## Заключение

Браузер - сложное программное обеспечение, объединяющее множество компонентов для предоставления пользователю современного и быстрого интернет опыта. Надеюсь, эта статья помогла вам лучше понять, как именно работает браузер, и какие процессы происходят, когда вы взаимодействуете с веб-страницами.